/************************************************************************/
/*                                                                      */
/* INCLUDE                                                              */
/*                                                                      */
/************************************************************************/
#include "texture2d.h"

#include "render/rhi/rhidevicecontext.h"
#include "render/rhi/rhidevice.h"

/************************************************************************/
/*                                                                      */
/* DEFINES AND CONSTANTS                                                */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* MACROS                                                               */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* TYPES                                                                */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* STRUCTS                                                              */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* CLASSES                                                              */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* LOCAL VARIABLES                                                      */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* GLOBAL VARIABLES                                                     */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* LOCAL FUNCTIONS                                                      */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* EXTERNAL FUNCTIONS                                                   */
/*                                                                      */
/************************************************************************/
//------------------------------------------------------------------------
// TEXTURE2D
//------------------------------------------------------------------------

//------------------------------------------------------------------------
// specialized for the output's texture
Texture2D::Texture2D( RHIDevice *owner, ID3D11Texture2D *tex ) 
   : device(owner)
   , dx_resource(tex)
   , dx_rtv(nullptr)
{
   if (tex != nullptr) {
      tex->AddRef();
      dx_resource = tex;

      D3D11_TEXTURE2D_DESC desc;
      tex->GetDesc(&desc);

      width = desc.Width;
      height = desc.Height;

      create_views();
   }
}

//------------------------------------------------------------------------
Texture2D::~Texture2D()
{
   destroy();
}

//------------------------------------------------------------------------
void Texture2D::destroy()
{
   if (is_valid()) {
      DX_SAFE_RELEASE(dx_rtv);
      DX_SAFE_RELEASE(dx_resource);
   }
}

//------------------------------------------------------------------------
void Texture2D::create_views()
{
   ID3D11Device *dd = device->dx_device;
   dd->CreateRenderTargetView( dx_resource, nullptr, &dx_rtv );
}


/************************************************************************/
/*                                                                      */
/* COMMANDS                                                             */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* UNIT TESTS                                                           */
/*                                                                      */
/************************************************************************/
