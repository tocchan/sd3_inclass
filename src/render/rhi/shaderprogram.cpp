/************************************************************************/
/*                                                                      */
/* INCLUDE                                                              */
/*                                                                      */
/************************************************************************/
#include "shaderprogram.h"

#include "render/vertex.h"
#include "render/rhi/rhidevice.h"

/************************************************************************/
/*                                                                      */
/* DEFINES AND CONSTANTS                                                */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* MACROS                                                               */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* TYPES                                                                */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* STRUCTS                                                              */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* CLASSES                                                              */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* LOCAL VARIABLES                                                      */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* GLOBAL VARIABLES                                                     */
/*                                                                      */
/************************************************************************/
//------------------------------------------------------------------------
ShaderProgram::ShaderProgram( RHIDevice *device,
   ID3D11VertexShader *vs, ID3D11PixelShader *fs, 
   ID3DBlob *vs_bytecode, ID3DBlob *fs_bytecode )
   : dx_vertex_shader(vs)
   , dx_fragment_shader(fs)
   , vs_byte_code(vs_bytecode)
   , fs_byte_code(fs_bytecode)
{
   dx_input_layout = nullptr;
   create_input_layout( device );
}

//------------------------------------------------------------------------
void ShaderProgram::create_input_layout( RHIDevice *device ) 
{
   D3D11_INPUT_ELEMENT_DESC desc[1];
   memset( desc, 0, sizeof(desc) );

   // 
   desc[0].SemanticName = "POSITION";
   desc[0].SemanticIndex = 0;
   desc[0].Format = DXGI_FORMAT_R32G32B32_FLOAT; 
   desc[0].InputSlot = 0U;
   desc[0].AlignedByteOffset = offsetof( vertex_t, position );
   desc[0].InputSlotClass = D3D11_INPUT_PER_VERTEX_DATA; 
   desc[0].InstanceDataStepRate = 0U;

   device->dx_device->CreateInputLayout( desc, 
      ARRAYSIZE(desc), 
      vs_byte_code->GetBufferPointer(), 
      vs_byte_code->GetBufferSize(), 
      &dx_input_layout );
}

/************************************************************************/
/*                                                                      */
/* LOCAL FUNCTIONS                                                      */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* EXTERNAL FUNCTIONS                                                   */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* COMMANDS                                                             */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* UNIT TESTS                                                           */
/*                                                                      */
/************************************************************************/
