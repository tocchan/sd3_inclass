/************************************************************************/
/*                                                                      */
/* INCLUDE                                                              */
/*                                                                      */
/************************************************************************/
#include "rhidevice.h"

#include "core/file.h"
#include "core/log.h"

#include "render/vertex.h"
#include "render/rhi/rhidevicecontext.h"
#include "render/rhi/rhiinstance.h"
#include "render/rhi/rhioutput.h"

#include "render/rhi/shaderprogram.h"
#include "render/rhi/vertexbuffer.h"

/************************************************************************/
/*                                                                      */
/* DEFINES AND CONSTANTS                                                */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* MACROS                                                               */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* TYPES                                                                */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* STRUCTS                                                              */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* CLASSES                                                              */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* LOCAL VARIABLES                                                      */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* GLOBAL VARIABLES                                                     */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* LOCAL FUNCTIONS                                                      */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* EXTERNAL FUNCTIONS                                                   */
/*                                                                      */
/************************************************************************/

//------------------------------------------------------------------------
// RENDER DEVICE
//------------------------------------------------------------------------

//------------------------------------------------------------------------
RHIDevice::RHIDevice( RHIInstance *owner, ID3D11Device *dxd )
{
   instance = owner;
   dx_device = dxd;
   immediate_context = nullptr;
}

//------------------------------------------------------------------------
RHIDevice::~RHIDevice()
{
   DX_SAFE_RELEASE(dx_device);
}

//------------------------------------------------------------------------
ShaderProgram* RHIDevice::create_shader_from_hlsl_file( char const *filename )
{
   ShaderProgram *program = new ShaderProgram( this, filename );
   if (nullptr == program) {
      return nullptr;
   }

   if (program->is_valid()) {
      return program;
   } else {
      delete program;
      return nullptr;
   }
}

//------------------------------------------------------------------------
VertexBuffer* RHIDevice::create_vertex_buffer( vertex_t *vertices, uint vertex_count )
{
   VertexBuffer *buffer = new VertexBuffer( this, vertices, vertex_count );
   return buffer;
}

//------------------------------------------------------------------------
Texture2D* RHIDevice::create_render_target( uint width, uint height )
{
   Texture2D *tex = new Texture2D( this, width, height, IMAGEFORMAT_RGBA8 );
   return tex;
}

//------------------------------------------------------------------------
Texture2D* RHIDevice::create_depth_target( uint width, uint height )
{
   Texture2D *tex = new Texture2D( this, width, height, IMAGEFORMAT_D24S8 );
   return tex;
}


/************************************************************************/
/*                                                                      */
/* COMMANDS                                                             */
/*                                                                      */
/************************************************************************/

/************************************************************************/
/*                                                                      */
/* UNIT TESTS                                                           */
/*                                                                      */
/************************************************************************/
